# PR #11: feat: add createEvent tool for calendar event creation

- **Author**: simon-77
- **State**: OPEN
- **Files changed**: extension/mcp_server/api.js
- **Additions/Deletions**: +123 / -0

## Summary

This PR adds a `createEvent` tool that opens a pre-filled event dialog in Thunderbird for user review before saving. This follows the same UX pattern as `sendMail` - the user always reviews and confirms before the action takes effect. The implementation supports timed and all-day events, location, description, and calendar selection.

The tool defaults to the first writable calendar if none is specified. Timed events default to 1 hour duration, and all-day events default to 1 day.

## Key Changes (with code snippets where relevant)

### 1. Tool schema definition

```javascript
{
  name: "createEvent",
  title: "Create Event",
  description: "Open a pre-filled event dialog in Thunderbird for user review before saving",
  inputSchema: {
    type: "object",
    properties: {
      title: { type: "string", description: "Event title" },
      startDate: { type: "string", description: "Start date/time in ISO 8601 format" },
      endDate: { type: "string", description: "End date/time in ISO 8601 (defaults to startDate + 1h ...)" },
      location: { type: "string", description: "Event location" },
      description: { type: "string", description: "Event description" },
      calendarId: { type: "string", description: "Target calendar ID (from listCalendars, ...)" },
      allDay: { type: "boolean", description: "Create an all-day event (default: false)" },
    },
    required: ["title", "startDate"],
  },
},
```

### 2. CalEvent import

The PR imports `CalEvent` from `resource:///modules/CalEvent.sys.mjs` alongside the existing `cal` utils module:

```javascript
const { CalEvent: CE } = ChromeUtils.importESModule(
  "resource:///modules/CalEvent.sys.mjs"
);
CalEvent = CE;
```

### 3. createEvent function

The function handles:
- All-day events using `isDate = true` on the datetime objects, with proper iCal DTEND exclusivity handling
- Timed events using `cal.dtz.jsDateToDateTime` conversion
- Calendar selection by ID or fallback to first writable calendar
- Read-only calendar validation
- Opens the event dialog via `win.openDialog("chrome://calendar/content/calendar-event-dialog.xhtml", ...)`

```javascript
const args = {
  calendarEvent: event,
  calendar: targetCalendar,
  mode: "new",
  inTab: false,
  onOk(item, calendar) {
    calendar.addItem(item);
  },
};
win.openDialog(
  "chrome://calendar/content/calendar-event-dialog.xhtml",
  "_blank",
  "centerscreen,chrome,titlebar,toolbar,resizable",
  args
);
```

## Discussion & Review Comments

No review comments or discussion on this PR.

## Relevance to Our Fork

Our fork has a `listCalendars` tool but no calendar event creation capability. The `createEvent` tool would be a natural complement. Our fork's `api.js` already imports `cal` from `resource:///modules/calendar/calUtils.sys.mjs` (line 199-205), so the calendar infrastructure is partially in place.

No manifest changes are needed since the PR does not add new permissions.

## Integration Recommendation

- **Should integrate**: yes
- **Priority**: medium
- **Effort**: small
- **Notes**: Clean implementation that follows the project's existing patterns. The code needs to import `CalEvent` in addition to the existing `cal` import. The dialog-based approach ensures user review before saving, which is consistent with the compose tools. Need to verify the `CalEvent` module path is correct for the Thunderbird version we target.

## Related Issues

None referenced.
